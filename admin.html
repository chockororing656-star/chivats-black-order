<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ADMIN ‚Äì CHIVATS BLACK</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body{
  margin:0;
  font-family:sans-serif;
  background:#111;
  color:#fff;
}
.container{
  max-width:600px;
  margin:auto;
  padding:20px;
}
h1{
  color:#f5c16c;
  text-align:center;
}
.order{
  background:#1e1e1e;
  padding:15px;
  margin:15px 0;
  border-radius:8px;
}
.order.received{
  opacity:0.6;
  border-left:5px solid #3cff8f;
}
.item{
  font-size:14px;
  margin-left:10px;
}
.total{
  color:#f5c16c;
  font-size:18px;
}
.time{
  font-size:12px;
  color:#aaa;
}
button{
  width:100%;
  padding:10px;
  margin-top:10px;
  font-size:16px;
  border:none;
  cursor:pointer;
}
.receive-btn{
  background:#3cff8f;
}
.hidden{
  display:none;
}
</style>
</head>

<body>

<div class="container" id="loginBox">
  <h1>üîê ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</h1>
  <input id="password" type="password" placeholder="‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô" style="width:100%;padding:10px;font-size:16px">
  <button onclick="login()" style="margin-top:10px;background:#f5c16c;">‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</button>
</div>

<div class="container hidden" id="adminBox">
  <h1>üìã ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h1>
  <div id="orders"></div>
</div>

<script>
/* ================== ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ ================== */
const ADMIN_PASSWORD = "1234"; // üëà ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡πÑ‡∏î‡πâ

const TELEGRAM_TOKEN = "8529657624:AAHeinqknXFiKrgyuyOz7h-GCbPUVoHWf3Q";
const TELEGRAM_CHAT_ID = "5665607150";

/* ================= Firebase ================= */
const firebaseConfig = {
  apiKey: "AIzaSyC03JcyEyEg4iWVKMfgcpDR82EUiFOXMd4",
  authDomain: "chivats-black-order.firebaseapp.com",
  projectId: "chivats-black-order",
  storageBucket: "chivats-black-order.appspot.com",
  messagingSenderId: "1012545451252",
  appId: "1:1012545451252:web:0df1a74dc553f201bddaa1"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

/* ================= Login ================= */
function login(){
  const pass = document.getElementById("password").value;
  if(pass === ADMIN_PASSWORD){
    document.getElementById("loginBox").classList.add("hidden");
    document.getElementById("adminBox").classList.remove("hidden");
    loadOrders();
  }else{
    alert("‚ùå ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á");
  }
}

/* ================= Load Orders ================= */
function loadOrders(){
  const ordersDiv = document.getElementById("orders");

  db.collection("orders")
    .orderBy("time","desc")
    .onSnapshot(snapshot=>{
      ordersDiv.innerHTML = "";
      snapshot.forEach(doc=>{
        const o = doc.data();
        const received = o.status === "received";

        let itemsHtml = "";
        o.items.forEach(i=>{
          itemsHtml += `<div class="item">‚Ä¢ ${i.name} x ${i.qty}</div>`;
        });

        const time = o.time?.toDate
          ? o.time.toDate().toLocaleString("th-TH")
          : "";

        ordersDiv.innerHTML += `
          <div class="order ${received ? "received" : ""}">
            <h3>üë§ ${o.name} (${o.phone})</h3>
            ${itemsHtml}
            <p class="total">üí∞ ${o.total} ‡∏ö‡∏≤‡∏ó</p>
            <p>üí≥ ${o.payment}</p>
            <p class="time">‚è∞ ${time}</p>
            ${
              received
              ? "<p>‚úÖ ‡∏£‡∏±‡∏ö‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÅ‡∏•‡πâ‡∏ß</p>"
              : <button class="receive-btn" onclick="receiveOrder('${doc.id}','${o.name}')">‚úî ‡∏£‡∏±‡∏ö‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</button>
            }
          </div>
        `;
      });
    });
}

/* ================= Receive Order ================= */
function receiveOrder(orderId,name){
  db.collection("orders").doc(orderId).update({
    status:"received"
  });

  fetch(`https://api.telegram.org/bot${TELEGRAM_TOKEN}/sendMessage`,{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({
      chat_id: TELEGRAM_CHAT_ID,
      text: ‚úÖ ‡∏£‡∏±‡∏ö‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÅ‡∏•‡πâ‡∏ß\nüë§ ${name}
    })
  });
}
</script>

</body>
</html>
