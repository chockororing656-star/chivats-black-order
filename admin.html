<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin ‚Äì CHIVATS BLACK</title>

<style>
body{
  margin:0;
  background:#0f0f0f;
  color:#fff;
  font-family:sans-serif;
}
.container{
  max-width:480px;
  margin:auto;
  padding:16px;
}
h1{color:#f5b942}
.order{
  background:#1c1c1c;
  padding:12px;
  border-radius:10px;
  margin-bottom:12px;
}
.status{
  padding:4px 10px;
  border-radius:6px;
  display:inline-block;
  font-size:12px;
}
.new{background:#ff9800;color:#000}
.done{background:#4caf50;color:#000}
button{
  margin-top:8px;
  width:100%;
  padding:10px;
  border:none;
  border-radius:8px;
  font-weight:bold;
}
.accept{background:#f5b942}
.finish{background:#4caf50}
</style>
</head>

<body>
<div class="container">
<h1>üì¶ ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ‚Äì CHIVATS BLACK</h1>
<div id="orders">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, query, orderBy, onSnapshot, doc, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "‡πÉ‡∏™‡πà‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì",
  authDomain: "‡πÉ‡∏™‡πà‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì",
  projectId: "‡πÉ‡∏™‡πà‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const ordersDiv = document.getElementById("orders");

const q = query(
  collection(db,"orders"),
  orderBy("time","desc")
);

onSnapshot(q,(snapshot)=>{
  ordersDiv.innerHTML="";
  if(snapshot.empty){
    ordersDiv.innerHTML="‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå";
    return;
  }

  snapshot.forEach(docSnap=>{
    const o = docSnap.data();
    const id = docSnap.id;

    const div = document.createElement("div");
    div.className="order";

    const time = o.time?.toDate().toLocaleString("th-TH") || "-";

    div.innerHTML = `
      <b>üë§ ${o.name}</b><br>
      üìû ${o.phone}<br>
      üïí ${time}<br>
      <hr>
      ${o.items.map(i=>`‚Ä¢ ${i.name} x${i.qty}`).join("<br>")}
      <hr>
      üí∞ <b>${o.total} ‡∏ö‡∏≤‡∏ó</b><br>
      <span class="status ${o.status==="done"?"done":"new"}">
        ${o.status==="done"?"‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß":"‡∏£‡∏≠‡∏£‡∏±‡∏ö‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå"}
      </span>

      ${o.status!=="done" ? `
        <button class="accept" onclick="acceptOrder('${id}')">‡∏£‡∏±‡∏ö‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</button>
        <button class="finish" onclick="finishOrder('${id}')">‡∏ó‡∏≥‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß</button>
      ` : ``}
    `;
    ordersDiv.appendChild(div);
  });
});

window.acceptOrder = async (id)=>{
  await updateDoc(doc(db,"orders",id),{status:"accepted"});
};

window.finishOrder = async (id)=>{
  await updateDoc(doc(db,"orders",id),{status:"done"});
};
</script>
</body>
</html>
