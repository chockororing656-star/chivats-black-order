<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
firebase.initializeApp({
  apiKey: "AIzaSyC03JcyEyEg4iWVKMfgcpDR82EUiFOXMd4",
  authDomain: "chivats-black-order.firebaseapp.com",
  projectId: "chivats-black-order",
});

const db = firebase.firestore();

function submitOrder(){
  const name = document.getElementById("customerName").value;
  const phone = document.getElementById("customerPhone").value;
  const payment = document.querySelector('input[name="pay"]:checked')?.value;

  if(!name || !phone || !payment){
    alert("กรุณากรอกข้อมูลให้ครบ");
    return;
  }

  const items = [];
  menuData.forEach((item,i)=>{
    if(cart[i] > 0){
      items.push({
        name: item.name,
        qty: cart[i],
        price: item.price
      });
    }
  });

  if(items.length === 0){
    alert("ยังไม่ได้เลือกสินค้า");
    return;
  }

  const total = items.reduce((s,i)=>s+(i.qty*i.price),0);

  db.collection("orders").add({
    name,
    phone,
    payment,
    items,
    total,
    status: "new",
    createdAt: firebase.firestore.FieldValue.serverTimestamp()
  }).then(()=>{
    alert("✅ ส่งออเดอร์เรียบร้อย");
    location.reload();
  }).catch(err=>{
    alert("❌ เกิดข้อผิดพลาด");
    console.error(err);
  });
}
</script>
