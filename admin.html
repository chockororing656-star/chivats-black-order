<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>ADMIN â€“ CHIVATS BLACK</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body{background:#111;color:#fff;font-family:sans-serif}
.card{border:1px solid #444;padding:10px;margin:10px}
.new{border-left:5px solid red}
.doing{border-left:5px solid orange}
.done{border-left:5px solid green}
button{margin:5px;padding:5px}
.timer{color:#f5c16c;font-weight:bold}
</style>
</head>

<body>
<h2>ğŸ“¦ à¸­à¸­à¹€à¸”à¸­à¸£à¹Œà¸—à¸±à¹‰à¸‡à¸«à¸¡à¸” â€“ CHIVATS BLACK</h2>
<div id="orders">à¸à¸³à¸¥à¸±à¸‡à¹‚à¸«à¸¥à¸”...</div>

<script>
firebase.initializeApp({
  apiKey:"AIzaSyC03JcyEyEg4iWVKMfgcpDR82EUiFOXMd4",
  authDomain:"chivats-black-order.firebaseapp.com",
  projectId:"chivats-black-order"
});
const db=firebase.firestore();

db.collection("orders").orderBy("time","desc")
.onSnapshot(s=>{
  orders.innerHTML="";
  s.forEach(docu=>{
    const d=docu.data();
    const id=docu.id;
    const t=d.time?.toDate();
    const timeTxt=t?t.toLocaleString("th-TH"):"";

    let timer="";
    if(d.status!=="done" && t){
      const diff=Math.floor((Date.now()-t)/1000);
      timer=`â± ${Math.floor(diff/60)}:${String(diff%60).padStart(2,"0")}`;
    }

    let items="";
    d.items.forEach(i=>items+=`<li>${i.name} x${i.qty}</li>`);

    orders.innerHTML+=`
    <div class="card ${d.status}">
      <b>${timeTxt}</b><br>
      <span class="timer">${timer}</span><br>
      ğŸ‘¤ ${d.name}<br>
      ğŸ“ ${d.phone}<br>
      ğŸ’³ ${d.payment}
      <ul>${items}</ul>
      ğŸ’° ${d.total} à¸šà¸²à¸—<br>
      <button onclick="setStatus('${id}','doing')">à¸£à¸±à¸šà¸­à¸­à¹€à¸”à¸­à¸£à¹Œ</button>
      <button onclick="setStatus('${id}','done')">à¹€à¸ªà¸£à¹‡à¸ˆà¹à¸¥à¹‰à¸§</button>
    </div>`;
  });
});

function setStatus(id,status){
  db.collection("orders").doc(id).update({
    status,
    finishedAt: status==="done"?new Date():null
  });
}
</script>
</body>
</html>
