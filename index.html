<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>CHIVATS BLACK ORDER</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{
  margin:0;
  font-family:sans-serif;
  background:#111;
  color:#fff;
}
.container{
  max-width:480px;
  margin:auto;
  padding:20px;
}
h1{
  color:#f5b301;
  text-align:center;
}
.menu-item{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin:10px 0;
}
button{
  padding:6px 12px;
  background:#f5b301;
  border:none;
  border-radius:6px;
  font-weight:bold;
}
input{
  width:100%;
  padding:10px;
  margin:8px 0;
}
.total{
  color:#00ff88;
  font-size:20px;
}
.submit{
  width:100%;
  padding:14px;
  font-size:18px;
  margin-top:10px;
}
</style>
</head>
<body>

<div class="container">
<h1>üç¢ CHIVATS BLACK</h1>

<div id="menu"></div>

<p class="total">üí∞ ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°: <span id="total">0</span> ‡∏ö‡∏≤‡∏ó</p>

<h3>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</h3>
<input id="name" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏™‡∏±‡πà‡∏á">
<input id="phone" placeholder="‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£">

<h3>‡∏ß‡∏¥‡∏ò‡∏µ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</h3>
<label><input type="radio" name="pay" value="‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î" checked> ‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î</label>
<label><input type="radio" name="pay" value="PromptPay"> PromptPay</label>

<button class="submit" onclick="submitOrder()">‡∏™‡πà‡∏á‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</button>
</div>

<!-- Firebase -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyC03JcyEyEg4iWVKMfgcpDR82EUiFOXMd4",
  authDomain: "chivats-black-order.firebaseapp.com",
  projectId: "chivats-black-order",
  storageBucket: "chivats-black-order.appspot.com",
  messagingSenderId: "1012545451252",
  appId: "1:1012545451252:web:0df1a74dc553f201bddaa1"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// ===== TELEGRAM =====
const TELEGRAM_TOKEN = "8529657624:AAHeinqknXFiKrgyuyOz7h-GCbPUVoHWf3Q";
const CHAT_ID = "5665607150";

// ===== MENU =====
const menuData = [
 {name:"‡πÄ‡∏Ñ‡∏ö‡∏±‡∏ö‡πÑ‡∏Å‡πà L", price:69},
 {name:"‡πÄ‡∏Ñ‡∏ö‡∏±‡∏ö‡πÑ‡∏Å‡πà M", price:60},
 {name:"‡πÄ‡∏ü‡∏£‡∏ô‡∏ü‡∏£‡∏≤‡∏¢‡πÄ‡∏Ç‡∏¢‡πà‡∏≤ L", price:45},
 {name:"‡πÄ‡∏ü‡∏£‡∏ô‡∏ü‡∏£‡∏≤‡∏¢‡πÄ‡∏Ç‡∏¢‡πà‡∏≤ M", price:40},
 {name:"‡πÑ‡∏Å‡πà‡∏õ‡πä‡∏≠‡∏õ‡πÄ‡∏Ç‡∏¢‡πà‡∏≤ L", price:45},
 {name:"‡πÑ‡∏Å‡πà‡∏õ‡πä‡∏≠‡∏õ‡πÄ‡∏Ç‡∏¢‡πà‡∏≤ M", price:40},
 {name:"‡πÄ‡∏ü‡∏£‡∏ô‡∏ü‡∏£‡∏≤‡∏¢+‡πÑ‡∏Å‡πà‡∏õ‡πä‡∏≠‡∏õ", price:45},
];

let cart = [];

const menuDiv = document.getElementById("menu");
menuData.forEach((m,i)=>{
  cart[i]=0;
  menuDiv.innerHTML += `
    <div class="menu-item">
      <span>${m.name} - ${m.price}‡∏ø</span>
      <div>
        <button onclick="add(${i})">+</button>
        <span id="q${i}">0</span>
        <button onclick="remove(${i})">-</button>
      </div>
    </div>
  `;
});

window.add = i => {
  cart[i]++;
  document.getElementById("q"+i).innerText = cart[i];
  updateTotal();
}
window.remove = i => {
  if(cart[i]>0) cart[i]--;
  document.getElementById("q"+i).innerText = cart[i];
  updateTotal();
}

function updateTotal(){
  let t=0;
  cart.forEach((q,i)=> t+=q*menuData[i].price);
  document.getElementById("total").innerText=t;
}

window.submitOrder = async ()=>{
  const name = document.getElementById("name").value;
  const phone = document.getElementById("phone").value;
  const payment = document.querySelector("input[name=pay]:checked").value;

  if(!name || !phone){
    alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏∞‡πÄ‡∏ö‡∏≠‡∏£‡πå");
    return;
  }

  const items = cart.map((q,i)=> q>0 ? {
    name:menuData[i].name,
    qty:q,
    price:menuData[i].price
  }:null).filter(Boolean);

  if(items.length===0){
    alert("‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏°‡∏ô‡∏π");
    return;
  }

  const total = items.reduce((s,i)=>s+i.qty*i.price,0);

  const order = {
    name,
    phone,
    payment,
    items,
    total,
    time:new Date().toISOString(),
    createdAt:serverTimestamp(),
    status:"‡∏£‡∏≠‡∏£‡∏±‡∏ö‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå"
  };

  await addDoc(collection(db,"orders"),order);

  sendTelegram(order);

  alert("‡∏™‡πà‡∏á‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢");
  location.reload();
}

// ===== TELEGRAM SEND =====
function sendTelegram(o){
  const text =
`üì¶ ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÉ‡∏´‡∏°‡πà - CHIVATS BLACK
üïí ${new Date(o.time).toLocaleString("th-TH")}
üë§ ${o.name}
üìû ${o.phone}
üí≥ ${o.payment}

üçó ${o.items.map(i=>`${i.name} x${i.qty}`).join("\n")}
üí∞ ‡∏£‡∏ß‡∏° ${o.total} ‡∏ö‡∏≤‡∏ó`;

  fetch(`https://api.telegram.org/bot${TELEGRAM_TOKEN}/sendMessage`,{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({ chat_id:CHAT_ID, text })
  });
}
</script>

</body>
</html>
