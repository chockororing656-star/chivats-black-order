<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>CHIVATS BLACK ORDER</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  background:#111;
  color:#fff;
  font-family:sans-serif;
  padding:20px;
}
h1 { color:#f5c97a; }
.menu-item {
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin:10px 0;
}
.qty button {
  width:30px;
  height:30px;
  font-size:18px;
}
.qty span {
  display:inline-block;
  width:30px;
  text-align:center;
}
.total {
  margin-top:20px;
  font-size:20px;
  color:#4cff9f;
}
input {
  width:100%;
  padding:10px;
  margin:8px 0;
  font-size:16px;
}
button.submit {
  width:100%;
  padding:15px;
  background:#f5c97a;
  border:none;
  font-size:18px;
  margin-top:15px;
}
.alert {
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.85);
  display:none;
  align-items:center;
  justify-content:center;
  text-align:center;
}
.alert-box {
  background:#222;
  padding:30px;
  border-radius:10px;
}
</style>
</head>

<body>

<h1>‡πÄ‡∏°‡∏ô‡∏π</h1>

<div id="menu"></div>

<div class="total">üí∞ ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°: <span id="total">0</span> ‡∏ö‡∏≤‡∏ó</div>

<h3>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</h3>
<input id="name" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤">
<input id="phone" placeholder="‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£">

<h3>‡∏ß‡∏¥‡∏ò‡∏µ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</h3>
<label><input type="radio" name="pay" value="‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î" checked> ‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î</label><br>
<label><input type="radio" name="pay" value="PromptPay"> PromptPay</label>

<button class="submit" onclick="submitOrder()">üì¶ ‡∏™‡πà‡∏á‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</button>

<!-- ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô -->
<div class="alert" id="alert">
  <div class="alert-box">
    <h2>‚úÖ ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡πÅ‡∏•‡πâ‡∏ß</h2>
    <p>‡∏£‡πâ‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢</p>
    <button onclick="location.reload()">‡∏õ‡∏¥‡∏î</button>
  </div>
</div>

<!-- Firebase -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "‡πÉ‡∏™‡πà‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì",
  authDomain: "‡πÉ‡∏™‡πà‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì",
  projectId: "‡πÉ‡∏™‡πà‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì",
  storageBucket: "‡πÉ‡∏™‡πà‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì",
  messagingSenderId: "‡πÉ‡∏™‡πà‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì",
  appId: "‡πÉ‡∏™‡πà‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const items = [
  {name:"‡πÄ‡∏Ñ‡∏ö‡∏±‡∏ö‡πÑ‡∏Å‡πà L", price:69},
  {name:"‡πÄ‡∏Ñ‡∏ö‡∏±‡∏ö‡πÑ‡∏Å‡πà M", price:60},
  {name:"‡πÄ‡∏ü‡∏£‡∏ô‡∏ü‡∏£‡∏≤‡∏¢‡πÄ‡∏Ç‡∏¢‡πà‡∏≤ L", price:45},
  {name:"‡πÄ‡∏ü‡∏£‡∏ô‡∏ü‡∏£‡∏≤‡∏¢‡πÄ‡∏Ç‡∏¢‡πà‡∏≤ M", price:40},
  {name:"‡πÑ‡∏Å‡πà‡∏õ‡πä‡∏≠‡∏õ‡πÄ‡∏Ç‡∏¢‡πà‡∏≤ L", price:45},
  {name:"‡πÑ‡∏Å‡πà‡∏õ‡πä‡∏≠‡∏õ‡πÄ‡∏Ç‡∏¢‡πà‡∏≤ M", price:40}
];

const state = {};

const menu = document.getElementById("menu");

items.forEach((i,idx)=>{
  state[idx]=0;
  menu.innerHTML += `
    <div class="menu-item">
      <div>${i.name} ${i.price}‡∏ø</div>
      <div class="qty">
        <button onclick="change(${idx},-1)">-</button>
        <span id="q${idx}">0</span>
        <button onclick="change(${idx},1)">+</button>
      </div>
    </div>
  `;
});

window.change = (i,v)=>{
  state[i] = Math.max(0,state[i]+v);
  document.getElementById("q"+i).innerText = state[i];
  calc();
}

function calc(){
  let sum=0;
  items.forEach((i,idx)=> sum += i.price*state[idx]);
  document.getElementById("total").innerText = sum;
}

window.submitOrder = async ()=>{
  const name = document.getElementById("name").value.trim();
  const phone = document.getElementById("phone").value.trim();
  if(!name || !phone){
    alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏∞‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£");
    return;
  }

  const orderItems = items
    .map((i,idx)=>({name:i.name, qty:state[idx], price:i.price}))
    .filter(i=>i.qty>0);

  if(orderItems.length===0){
    alert("‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏°‡∏ô‡∏π");
    return;
  }

  const pay = document.querySelector('input[name="pay"]:checked').value;
  const total = Number(document.getElementById("total").innerText);

  await addDoc(collection(db,"orders"),{
    customerName:name,
    customerPhone:phone,
    items:orderItems,
    total:total,
    payment:pay,
    createdAt:serverTimestamp()
  });

  document.getElementById("alert").style.display="flex";
}
</script>

</body>
</html>
