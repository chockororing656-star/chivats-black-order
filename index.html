<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyC03JcyEyEg4iWVKMfgcpDR82EUiFOXMd4",
  authDomain: "chivats-black-order.firebaseapp.com",
  projectId: "chivats-black-order"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

function submitOrder(){
  const name = document.getElementById("customerName").value;
  const phone = document.getElementById("customerPhone").value;
  const payment = document.querySelector("input[name='pay']:checked")?.value;

  if(!name || !phone || !payment){
    alert("‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö");
    return;
  }

  const items = [];
  menuData.forEach((item,i)=>{
    if(cart[i] > 0){
      items.push({
        name: item.name,
        price: item.price,
        qty: cart[i]
      });
    }
  });

  if(items.length === 0){
    alert("‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏≤‡∏´‡∏≤‡∏£");
    return;
  }

  const total = items.reduce((s,i)=>s+(i.price*i.qty),0);

  // üî• ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏Ç‡πâ‡∏≤ Firestore
  db.collection("orders").add({
    name,
    phone,
    payment,
    items,
    total,
    time: firebase.firestore.FieldValue.serverTimestamp(),
    status: "new"
  })
  .then(()=>{
    alert("‚úÖ ‡∏™‡πà‡∏á‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢");
    location.reload();
  })
  .catch(err=>{
    alert("‚ùå ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
    console.error(err);
  });
}
</script>
