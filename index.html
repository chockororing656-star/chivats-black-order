<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>CHIVATS BLACK ORDER</title>

<!-- Firebase CDN (‡πÉ‡∏ä‡πâ‡πÅ‡∏ö‡∏ö‡∏ô‡∏µ‡πâ‡∏Å‡∏±‡∏ö GitHub Pages ‡πÑ‡∏î‡πâ) -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body{
  margin:0;
  font-family:sans-serif;
  background:#111;
  color:#fff;
}
.container{
  max-width:480px;
  margin:auto;
  padding:20px;
}
h1{
  color:#f5c16c;
}
.menu-item{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin:10px 0;
}
.qty-box{
  display:flex;
  align-items:center;
}
.qty-box button{
  width:32px;
  height:32px;
  font-size:18px;
}
.qty{
  width:30px;
  text-align:center;
}
.total{
  color:#3cff8f;
  font-size:20px;
  margin:15px 0;
}
input{
  width:100%;
  padding:10px;
  margin:8px 0;
  font-size:16px;
}
.payment{
  display:flex;
  gap:20px;
  margin:10px 0;
}
.order-btn{
  width:100%;
  padding:15px;
  background:#f5c16c;
  border:none;
  font-size:18px;
  cursor:pointer;
}
</style>
</head>

<body>
<div class="container">
  <h1>‡πÄ‡∏°‡∏ô‡∏π</h1>

  <div id="menu"></div>

  <div class="total">üí∞ ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°: <span id="total">0</span> ‡∏ö‡∏≤‡∏ó</div>

  <h3>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</h3>
  <input id="customerName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏™‡∏±‡πà‡∏á"/>
  <input id="customerPhone" placeholder="‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£"/>

  <h3>‡∏ß‡∏¥‡∏ò‡∏µ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</h3>
  <div class="payment">
    <label><input type="radio" name="pay" value="‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î" checked> ‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î</label>
    <label><input type="radio" name="pay" value="PromptPay"> PromptPay</label>
  </div>

  <button class="order-btn" onclick="submitOrder()">üì¶ ‡∏™‡πà‡∏á‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</button>
</div>

<script>
/* ================= Firebase ================= */
const firebaseConfig = {
  apiKey: "AIzaSyC03JcyEyEg4iWVKMfgcpDR82EUiFOXMd4",
  authDomain: "chivats-black-order.firebaseapp.com",
  projectId: "chivats-black-order",
  storageBucket: "chivats-black-order.appspot.com",
  messagingSenderId: "1012545451252",
  appId: "1:1012545451252:web:0df1a74dc553f201bddaa1"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

/* ================= ‡πÄ‡∏°‡∏ô‡∏π ================= */
const menuData = [
  {name:"‡πÄ‡∏Ñ‡∏ö‡∏±‡∏ö‡πÑ‡∏Å‡πà L", price:69},
  {name:"‡πÄ‡∏Ñ‡∏ö‡∏±‡∏ö‡πÑ‡∏Å‡πà M", price:60},
  {name:"‡πÄ‡∏ü‡∏£‡∏ô‡∏ü‡∏£‡∏≤‡∏¢‡πÄ‡∏Ç‡∏¢‡πà‡∏≤ L", price:45},
  {name:"‡πÄ‡∏ü‡∏£‡∏ô‡∏ü‡∏£‡∏≤‡∏¢‡πÄ‡∏Ç‡∏¢‡πà‡∏≤ M", price:40},
  {name:"‡πÑ‡∏Å‡πà‡∏õ‡πä‡∏≠‡∏õ‡πÄ‡∏Ç‡∏¢‡πà‡∏≤ L", price:45},
  {name:"‡πÑ‡∏Å‡πà‡∏õ‡πä‡∏≠‡∏õ‡πÄ‡∏Ç‡∏¢‡πà‡∏≤ M", price:40}
];

const cart = {};
const menuDiv = document.getElementById("menu");

menuData.forEach((item,i)=>{
  cart[i]=0;
  menuDiv.innerHTML += `
    <div class="menu-item">
      <div>${item.name} ${item.price}‡∏ø</div>
      <div class="qty-box">
        <button onclick="changeQty(${i},-1)">-</button>
        <div class="qty" id="qty${i}">0</div>
        <button onclick="changeQty(${i},1)">+</button>
      </div>
    </div>
  `;
});

function changeQty(i,delta){
  cart[i]=Math.max(0,cart[i]+delta);
  document.getElementById("qty"+i).innerText=cart[i];
  calcTotal();
}

function calcTotal(){
  let total=0;
  menuData.forEach((item,i)=>{
    total+=item.price*cart[i];
  });
  document.getElementById("total").innerText=total;
}

/* ================= ‡∏™‡πà‡∏á‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå ================= */
function submitOrder(){
  const name=document.getElementById("customerName").value.trim();
  const phone=document.getElementById("customerPhone").value.trim();
  const payment=document.querySelector('input[name="pay"]:checked').value;

  if(!name || !phone){
    alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏∞‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£");
    return;
  }

  const items=[];
  menuData.forEach((item,i)=>{
    if(cart[i]>0){
      items.push({...item,qty:cart[i]});
    }
  });

  if(items.length===0){
    alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏°‡∏ô‡∏π");
    return;
  }

  const order={
    name,
    phone,
    payment,
    items,
    total:Number(document.getElementById("total").innerText),
    time: new Date()
  };

  db.collection("orders").add(order)
    .then(()=>{
      alert("‚úÖ ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡πÅ‡∏•‡πâ‡∏ß ‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏£‡∏±‡∏ö");
      location.reload();
    })
    .catch(err=>{
      alert("‚ùå ‡∏™‡πà‡∏á‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
      console.error(err);
    });
}
</script>
</body>
</html>
